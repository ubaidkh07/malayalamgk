<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malayalam GK Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Manjari:wght@400;700&display=swap');
        
        body {
            font-family: 'Manjari', sans-serif;
            background-color: #f3f4f6;
        }

        /* Option buttons - Square corners */
        .option-btn {
            transition: all 0.2s ease;
            border-radius: 4px; /* Minimal rounding for a sharp look */
            text-align: left;
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid #e5e7eb;
            background-color: white;
            font-weight: 600;
            color: #374151;
            font-size: 1.125rem;
        }

        .option-btn:hover {
            border-color: #3b82f6;
            background-color: #f9fafb;
        }

        .correct-answer {
            background-color: #10b981 !important;
            color: white !important;
            border-color: #059669 !important;
        }

        .wrong-answer {
            background-color: #ef4444 !important;
            color: white !important;
            border-color: #dc2626 !important;
        }

        .disabled-btn {
            cursor: not-allowed;
            pointer-events: none;
        }

        .timer-critical {
            background-color: #ef4444 !important;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="quiz-container" class="bg-white w-full max-w-lg shadow-2xl overflow-hidden rounded-lg">
        <!-- Header -->
        <div class="bg-blue-700 p-6 text-white flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold">പൊതുവിജ്ഞാനം ക്വിസ്</h1>
                <p class="text-xs opacity-75">By Ubaid Kh</p>
            </div>
            <div id="timer-box" class="bg-blue-900 px-4 py-2 font-mono text-xl font-bold rounded">
                00:<span id="seconds">30</span>
            </div>
        </div>

        <!-- Progress bar -->
        <div class="h-1 w-full bg-gray-100">
            <div id="progress-bar" class="h-full bg-blue-500 transition-all duration-300" style="width: 0%"></div>
        </div>

        <div class="p-6">
            <div id="loading" class="text-center py-10">
                <p class="text-gray-500 italic">ചോദ്യങ്ങൾ ലോഡ് ചെയ്യുന്നു...</p>
            </div>

            <div id="game-ui" class="hidden">
                <div class="flex justify-between mb-4 text-xs font-bold text-gray-400 uppercase tracking-widest">
                    <span>ചോദ്യം: <span id="current-q-num" class="text-blue-600">1</span> / <span id="total-q-num">0</span></span>
                    <span>സ്കോർ: <span id="score" class="text-green-600">0</span></span>
                </div>
                
                <h2 id="question-text" class="text-xl font-bold mb-6 leading-relaxed text-gray-800">
                    ചോദ്യം ഇവിടെ വരും...
                </h2>

                <div id="options-container" class="space-y-3">
                    <!-- Options Injected Here -->
                </div>

                <div class="mt-8 flex justify-between items-center h-12">
                    <p id="msg-box" class="font-bold text-sm"></p>
                    <button id="next-btn" class="hidden bg-blue-700 hover:bg-blue-800 text-white px-6 py-2 font-bold rounded shadow-md transition-transform active:scale-95">
                        അടുത്ത ചോദ്യം
                    </button>
                </div>
            </div>

            <!-- Result View -->
            <div id="result-ui" class="hidden text-center py-10">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">അവസാനിച്ചു!</h2>
                <div class="my-6 p-6 bg-gray-50 border border-gray-100">
                    <p class="text-gray-500 uppercase text-xs font-bold mb-1">നിങ്ങളുടെ സ്കോർ</p>
                    <p id="final-score" class="text-5xl font-black text-blue-700">0 / 0</p>
                </div>
                <button onclick="location.reload()" class="w-full bg-blue-700 text-white py-4 font-bold text-lg hover:bg-blue-800 transition-colors">
                    വീണ്ടും കളിക്കുക
                </button>
            </div>
        </div>
    </div>

    <script>
        const GITHUB_API_URL = "https://raw.githubusercontent.com/ubaidkh07/malayalamgk/refs/heads/main/gk.json";
        const TIMER_LIMIT = 30;
        
        let questions = [];
        let currentIdx = 0;
        let score = 0;
        let timer;
        let timeLeft = TIMER_LIMIT;
        let canAnswer = true;

        const elements = {
            loading: document.getElementById('loading'),
            gameUI: document.getElementById('game-ui'),
            resultUI: document.getElementById('result-ui'),
            question: document.getElementById('question-text'),
            options: document.getElementById('options-container'),
            timerBox: document.getElementById('timer-box'),
            seconds: document.getElementById('seconds'),
            nextBtn: document.getElementById('next-btn'),
            score: document.getElementById('score'),
            currentNum: document.getElementById('current-q-num'),
            totalNum: document.getElementById('total-q-num'),
            progress: document.getElementById('progress-bar'),
            msg: document.getElementById('msg-box')
        };

        async function init() {
            try {
                const res = await fetch(GITHUB_API_URL);
                if (!res.ok) throw new Error();
                questions = await res.json();
            } catch (e) {
                // Fallback
                questions = [{ "q": "ആദ്യത്തെ മലയാള പത്രം ഏതാണ്?", "a": ["ദീപിക", "മലയാള മനോരമ", "രാജ്യസമാചാരം", "മാതൃഭൂമി"], "correct": 2 }];
            }
            
            elements.totalNum.innerText = questions.length;
            elements.loading.classList.add('hidden');
            elements.gameUI.classList.remove('hidden');
            renderQuestion();
        }

        function renderQuestion() {
            if (currentIdx >= questions.length) return endQuiz();

            canAnswer = true;
            timeLeft = TIMER_LIMIT;
            elements.nextBtn.classList.add('hidden');
            elements.msg.innerText = "";
            elements.timerBox.classList.remove('timer-critical');
            
            const q = questions[currentIdx];
            elements.question.innerText = q.q;
            elements.currentNum.innerText = currentIdx + 1;
            elements.progress.style.width = `${(currentIdx / questions.length) * 100}%`;

            elements.options.innerHTML = "";
            q.a.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "option-btn";
                btn.innerText = opt;
                btn.onclick = () => handleSelect(btn, i);
                elements.options.appendChild(btn);
            });

            startTimer();
        }

        function startTimer() {
            clearInterval(timer);
            updateTimerUI();
            timer = setInterval(() => {
                timeLeft--;
                updateTimerUI();
                if (timeLeft <= 5) elements.timerBox.classList.add('timer-critical');
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    canAnswer = false;
                    highlightCorrect();
                    elements.msg.innerText = "സമയം കഴിഞ്ഞു!";
                    elements.msg.className = "font-bold text-sm text-red-500";
                    elements.nextBtn.classList.remove('hidden');
                }
            }, 1000);
        }

        function updateTimerUI() {
            elements.seconds.innerText = timeLeft < 10 ? '0' + timeLeft : timeLeft;
        }

        function handleSelect(btn, idx) {
            if (!canAnswer) return;
            canAnswer = false;
            clearInterval(timer);

            const correct = questions[currentIdx].correct;
            if (idx === correct) {
                btn.classList.add('correct-answer');
                score++;
                elements.score.innerText = score;
                elements.msg.innerText = "ശരിയായ ഉത്തരം!";
                elements.msg.className = "font-bold text-sm text-green-600";
            } else {
                btn.classList.add('wrong-answer');
                elements.msg.innerText = "തെറ്റായ ഉത്തരം!";
                elements.msg.className = "font-bold text-sm text-red-500";
                highlightCorrect();
            }
            elements.nextBtn.classList.remove('hidden');
        }

        function highlightCorrect() {
            const correct = questions[currentIdx].correct;
            const btns = elements.options.querySelectorAll('button');
            btns.forEach((b, i) => {
                b.classList.add('disabled-btn');
                if (i === correct) b.classList.add('correct-answer');
                else b.style.opacity = "0.7";
            });
        }

        elements.nextBtn.onclick = () => {
            currentIdx++;
            renderQuestion();
        };

        function endQuiz() {
            elements.gameUI.classList.add('hidden');
            elements.resultUI.classList.remove('hidden');
            elements.progress.style.width = "100%";
            document.getElementById('final-score').innerText = `${score} / ${questions.length}`;
        }

        window.onload = init;
    </script>
</body>
</html>
